2007-01-02  Tomas Cerha  <cerha@brailcom.org>

	* translations/wiking.pl.po: New translations.

	* doc/src/user/accessibility.pl.txt: New file.

	* doc/src/user/navigation.pl.txt: New file.

	* doc/src/user/rss.pl.txt: New file.

2006-12-23  Tomas Cerha  <cerha@brailcom.org>

	* Makefile (install): Don't depend on `translations'.

2006-12-22  Tomas Cerha  <cerha@brailcom.org>

	* lib/wiking/modules.py (News.Spec.fields): Use the `DateTime'
	type for `timestamp'.  Make `date' a virtual column with a
	computer.
	(News.Spec._rss_title): Export both values.
	(News.Spec._date): New method.
	(Planner.Spec.fields): Use the `Date' type for `start_date' and
	`end_date'.
	(Planner.Spec._date): Export dates with a weekday.
	(Users.Spec.fields): Use the `DateTime' type for the field
	`since'.

	* lib/wiking/module.py (WikingModule._datetime_formats): New
	method.
	(WikingModule._validate): Take `req' argument instead of just
	value dict.  Choose the correct date/time formats for validation
	according to current language.
	(WikingModule.insert, WikingModule.update): Pass `req' to
	`self._validate'.

	* lib/wiking/util.py (DateTime, Date): New classes.
	(translator): New function.

	* lib/wiking/handler.py (_translator): Method removed.
	(SiteHandler.handle): Use the `translator()' function instead of
	the method.

2006-12-21  Tomas Cerha  <cerha@brailcom.org>

	* doc/src/admin/Planner.en.txt: New file.

	* doc/src/admin/Planner.cs.txt: New file.

	* lib/wiking/modules.py (Modules.Spec.fields): New field `ord'.
	(Modules.Spec): Added `ord' to layout, columns and sorting.
	(Modules.menu): Sort menu by `ord'.
	(Content._variants): Return only published variants.
	(News.ListView._export_row): Export `content' only when not null.
	(Planner.Spec.fields): New fields `start_date' and `end_date'.
	`date' is just a virtual field computed from both dates.
	(Planner.Spec.sorting): Sort by `start_date'.
	(Planner.Spec._check_date, Planner.Spec._date) 
	(Planner.Spec.check): New methods.
	(Planner._condition): Use both dated in the condition.

	* lib/wiking/module.py (WikingModule._validate): Added support for
	the `check' constraint.

	* translations/wiking.cs.po: Updated.

	* lib/wiking/export.py (Exporter._login_ctrl): "Anonymous" ->
	"anonymous".

	* sql/wiking.sql (modules): New column `ord'.
	(planner): Column `date' renamed to `start_date'.  New column
	`end_date'.  Allow null values for `content'.

	* sql/init.sql: Insert modules with order numbers.

2006-12-20  Tomas Cerha  <cerha@brailcom.org>

	* sql/wiking.sql (planner): New table.

	* lib/wiking/util.py (Data.get_rows): New keyword argument
	`condition'.

	* lib/wiking/modules.py (Modules.Spec.columns): Use `name', not
	`title' in layout.
	(Content.Spec.fields): Define as a method.
	(News.Spec.fields): New field `rss_title'.
	(News.ListView._export_row): Don't use `news-' prefix for anchors.
	Use the first field as a key column.
	(News._link_provider): Don't use `news-' prefix for anchors.  Use
	`self._referer' as key column.
	(Planner): New class.

	* lib/wiking/module.py (WikingModule._spec_cache): New attribute.
	(WikingModule.spec): Use common cache
	`WikingModule._cpec_cache', not a class attribute.
	(WikingModule._default_prefill): New method.
	(WikingModule.add): Use it.
	(WikingModule._condition): New method.
	(WikingModule._rows): New method.
	(WikingModule._list): Use `self._rows'.  New argument `limit'.
	(WikingModule.panelize): Use `self._rows'.  Handle empty list.
	(WikingModule.rss): Raise `NotFound' when `self._RSS_TITLE_COLUMN'
	is not defined.  Use `PresentedRow' to support virtual columns.
	(WikingModule.list): Print RSS info when `self._RSS_TITLE_COLUMN'
	is defined, not `self._RSS_DESCR_COLUMN'.

2006-12-19  Tomas Cerha  <cerha@brailcom.org>

	* lib/wiking/modules.py (Config.Spec.fields): New field `login_panel'.
	(News.Spec.fields): Set default timestamp in GMT.
	(Users.Spec.fields): Set type of `login' to Identifier.  New
	columns for session handling.
	(Users._user, Users._update, Users.user, Users.check_session) 
	(Users.save_session, Users.close_session): New methods.

	* lib/wiking/request.py (Request.get_cookie): Renamed to `cookie'.
	(WikingRequest._LOGIN_COOKIE, WikingRequest._SESSION_COOKIE)
	(WikingRequest._MAX_SESSION_KEY): New constants.
	(WikingRequest._init_params): `get_cookie()' -> `cookie'.  Process
	login form data.
	(WikingRequest.prefered_language): Docstring added.
	(WikingRequest.login_name): New method.
	(WikingRequest.user): New method.
	(WikingRequest.prefered_language): New method.
	(WikingRequest.check_auth): New method.

	* lib/wiking/util.py (Action.name): Renamed to `title()'.
	(Unauthorized): New class.
	(PanelItem.__init__): Take just `fields' argument.
	(PanelItem.export): Completely rewritten.
	(PanelItem._export_field): Method removed.
	(LoginDialog): New class.

	* lib/wiking/module.py (WikingModule.panelize): Use PresentedRow
	to support computed columns.  Pass simplified arguments to
	PanelItem constructor.
	

	* doc/src/user/navigation.en.txt: Updated.

	* doc/src/user/navigation.cs.txt: Updated.

	* lib/wiking/export.py (Exporter._page): New method.
	(Exporter._panels): Put both panel controls above the panels.  Add
	login panel if enabled.
	(Exporter._content): Cosmetic changes.
	(Exporter._wiking_bar): Cosmetic changes.

	* lib/wiking/handler.py (SiteHandler._translator): New method.
	(SiteHandler.handle): Handle also `Unauthorized' errors.  Use
	`self._translator'.
	(SiteHandler.handle): Set `config.user' for exporter.

	* resources/css/default.css:  Added styles for login form.

	* resources/css/panels.css: Added styles for login panel.

	* sql/wiking.sql (users): New columns for session handling and
	access rights.
	(config): New column `login_panel'.
	
2006-12-14  Tomas Cerha  <cerha@brailcom.org>

	* lib/wiking/modules.py (Users.Spec.fields): Transformed to a
	method.

	* Makefile (doc): New target to generate HTML documentation.

	* README: Refer to the documentation.

	* doc/src/admin/Stylesheets.en.txt: New file.

	* doc/src/admin/admin.en.txt: New file.

	* doc/src/user/user.en.txt: New file.

	* doc/src/user/user.cs.txt: New file.

	* doc/src/user/_index.txt: New file.

	* doc/src/intro.en.txt: New file.

	* doc/src/index.en.txt: New file.

	* doc/src/fdl.en.txt: New file.

	* doc/src/_index.txt: New file.

2006-12-13  Tomas Cerha  <cerha@brailcom.org>

	* lib/wiking/request.py (Request.__init__): Call
	`self._init_uri()' to initialize the `uri' attribute.
	(Request._init_uri): New metohd.
	(WikingRequest._init_params): Use argument `setlang' for explicit
	language, not `lang' and `keep_language'.
	(WikingRequest._init_uri): New method.  Perform RSS redirection
	here transparently.

	* lib/wiking/module.py (WikingModule.rss): Don't care about the
	uri redirection here.  Use argument `setlang' for explicit
	language.

	* lib/wiking/handler.py (SiteHandler._action): Don't perform the
	RSS redirect here.

	* lib/wiking/export.py (Exporter._node_uri): Use argument
	`setlang' for explicit language, not `lang' and `keep_language'.

	* lib/wiking/util.py (Document.__init__): New keyword argument
	`sec_lang'.
	(Document.mknode): Pass `secondary_language' to the node
	constructor.
	(NotAcceptable.msg): Use argument `setlang' for explicit language,
	not `lang' and `keep_language'.

2006-12-12  Tomas Cerha  <cerha@brailcom.org>

	* doc/modules/Languages.cs.txt (Module): Minor improvements.
	
	* doc/modules/Languages.en.txt (Module): Minor improvements.

2006-12-11  Tomas Cerha  <cerha@brailcom.org>

	* translations/wiking.cs.po (Module): Updated.

	* translations/wiking.pl.po (Module): Updated.

	* translations/wiking.es.po (Module): Updated.

	* resources/css/default.css: Don't suppress underlining TOC links.

	* lib/wiking/modules.py (Mapping._link_provider): New argument
	`args'.  WMI uri changed to `_wmi'.
	(Config.theme): Removed commented theme caching.
	(News._link_provider): New argument `args'.

	* lib/wiking/module.py (_on_update): Method removed.
	(WikingModule._link_provider): New argument `args'.  Encode args
	into the final uri.  Use `_html.uri' for generating the uri.
	(WikingModule._list): New argument `lang'.  Use `lang' if given.
	(WikingModule.list): Doc uri changed to `_doc'.  Add link to RSS
	documentation.
	(WikingModule.update): Don't call `self._on_update()'.

	* lib/wiking/install.py (maybe_install): WMI uri changed to `_wmi'.

	* lib/wiking/handler.py (SiteHandler._resolve): Recognize the
	language suffix in the rss uri.
	(SiteHandler._doc): Search all subdirectories.  Don't create TOC
	automatically.
	(SiteHandler.handle): WMI uri changed to `_wmi'.  Doc uri changed
	to `_doc'.  Set the `doc' attribute of node config.  Support
	displaying documentation inline.

	* lib/wiking/export.py (Exporter._menu): Added accesskeys.
	(Exporter._content): Cosmetic change.
	(Exporter.ctrl): Changed WMI uri.  Also recognize the doc state.
	(Exporter._footer): Added `Accessibility Statement' link.

	* doc/modules/Mapping.cs.txt: Minor improvements.

	* doc/modules/Mapping.en.txt: Minor improvements.

	* doc/user/rss.cs.txt: New file.
	
	* doc/user/rss.en.txt: New file.

2006-12-10  Tomas Cerha  <cerha@brailcom.org>

	* doc/user/accessibility.cs.txt: New file.

	* doc/user/accessibility.en.txt: New file.

2006-12-05  Tomas Cerha  <cerha@brailcom.org>

	* lib/wiking/modules.py: Define aliases for useful constants here,
	don't import them from pytis.extensions.
	(Themes.Spec.layout): New method.

	* lib/wiking/__init__.py (__version__): Don't import pytis.extensions.

	* lib/wiking/util.py (cmp_versions): New function.

	* Makefile: New file.

	* README: New file.

2006-12-04  Tomas Cerha  <cerha@brailcom.org>

	* doc/modules/Languages.cs.txt: Minor improvements.
	
	* doc/modules/Languages.en.txt: Minor improvements.

	* lib/wiking/modules.py
	(Modules.Spec._ModNameType._VALIDATION_MESSAGES): Konstanta zru¹ena.
	(Modules.Spec._ModNameType._VM_UNKNOWN_MODULE_MSG): Nová konstanta.
	(Mapping.Spec): Nastav maximální délku identifikátoru.

2006-12-01  Tomas Cerha  <cerha@brailcom.org>

	* lib/wiking/request.py (Request.abs_uri): Guess protocol based on
	port number.

	* lib/wiking/export.py (Exporter._panels): Panel control labels
	changed.  Represent panel headings as divs, not h1 tags.
	(Exporter._panels): Improved handling of horizontal rules.

	* lib/wiking/configuration.py: 
	(Configuration._Option_https_ports): New option.

2006-11-30  Tomas Cerha  <cerha@brailcom.org>

	* translations/wiking-help.cs.po: File removed.

	* resources/css/default.css: Added styles for panel controls.

	* lib/wiking/modules.py (Panelizable): Class removed.
	(Modules, Mapping, Config, Languages, Themes, Stylesheets, Users) 
	(Panels, Titles, Content, News): Specifications rewritten using
	a class derived from `pytis.presentation.Specification'.

	* lib/wiking/module.py (WikingModule._TITLE)
	(WikingModule._SINGULAR_TITLE, WikingModule._FIELDS)
	(WikingModule._LAYOUT, WikingModule._LAYOUT_COLUMNS)
	(WikingModule._TABLE, WikingModule._KEY, WikingModule._SORTING)
	(WikingModule._CB_SPEC, WikingModule._COLUMNS)
	(WikingModule._ACTIONS):Constants removed.
	(WikingModule._PANEL_DEFAULT_COUNT, WikingModule._PANEL_FIELDS):
	New constants.
	(WikingModule.Object.__init__): New argument `view'.
	(WikingModule.Object.__init__, WikingModule.Object.prow): New
	method.
	(WikingModule.View.__init__): New argument `resolver'.
	(WikingModule.ListView.__init__): New argument `resolver'.
	(WikingModule.spec): New method.
	(WikingModule.data_spec, WikingModule.view_spec)
	(WikingModule.binding_spec, WikingModule.cb_spec): Methods
	removed.
	(WikingModule.__init__): New argument `resolver'.  Use
	`self.spec()' to get the `Specification' instance.  Get
	specifications form this instance.  Don't translate sorting spec.
	(WikingModule._form): New method.
	(WikingModule._help): Method removed.
	(WikingModule._document): Use `self._view.singular()' instead of
	`self._view.layout().caption()'.
	(WikingModule._list): Soppose `distinct()' to return a sequence of
	`Value' instances.
	(WikingModule.resolve): Pass `self._view' to the Object
	constructor.
	(WikingModule.panelize): New method.
	(WikingModule.list): Include just a link to documentation, not hte
	help text itself.
	(WikingModule.list, WikingModule.show, WikingModule.add) 
	(WikingModule.edit, WikingModule.remove): Use `self._form()'
	instead of constructing the form directly.
	(WikingModule.insert):  Pass `self._view' to the Object
	constructor.

	* lib/wiking/handler.py (Handler._site_handler): Pass a resolver
	instance to `SiteHandler' constructor.
	(SiteHandler.__init__): New argument `resolver'.
	(SiteHandler._module): Pass a resolver instance to module
	constructor.
	(SiteHandler._stylesheets): Accept `req' and `panels' arguments.
	(SiteHandler._doc): Also support wiking documentation in wiking
	doc directory.
	(SiteHandler.handle): Heavilly rewritten.  Improved documentation
	handling.  Pass options to the exporter in the node config.  Don't
	use `TRANSLATION_PATH', build it here.

	* lib/wiking/__init__.py (TRANSLATION_PATH): Constant removed.
	Don't import `help'.

	* lib/wiking/export.py (Exporter._is_wmi_node): Method removed.
	(Exporter._top): Always use `config.site_title'.
	(Exporter._panels): Hide panels if `config.show_panels' is False.
	Show panel show/hide controls.
	(Exporter.ctrls): Use `config.wmi' instead of `self._is_wmi_node()'.

	* lib/wiking/help.py: Module removed. 

	* lib/wiking/request.py (WikingRequest._PANELS_COOKIE): New class.
	(WikingRequest._init_params): Initialize `self._show_panels'.
	(WikingRequest.show_panels): New method.
	(WikingRequest.__init__): Method removed.

	* lib/wiking/util.py (split_camel_case, camel_case_to_lower):
	Functions removed.
	(HttpError.name): Use `split_camel_case' from Pytis.
	(__init__, available): Methods removed.
	(NotAcceptable.msg): Use `self.args' instead of `self._available'.
	(Field): Class removed - be just an alias to
	`pytis.presentation.FieldSpec'
	(WikingResolver.get): Use specification classes instead of modules
	directly.
	(DirectData): Class removed.

	* doc/modules/Titles.en.txt: New file.
	
	* doc/modules/Titles.cs.txt: New file.

	* doc/modules/Panels.en.txt: New file.

	* doc/modules/Panels.cs.txt: New file.

	* doc/modules/News.en.txt: New file.

	* doc/modules/News.cs.txt: New file.

	* doc/modules/Modules.en.txt: New file.

	* doc/modules/Modules.cs.txt: New file.

	* doc/modules/Mapping.en.txt: New file.

	* doc/modules/Mapping.cs.txt: New file.

	* doc/modules/Languages.en.txt: New file.

	* doc/modules/Languages.cs.txt: New file.

	* doc/modules/Content.en.txt: New file.

	* doc/modules/Content.cs.txt: New file.

2006-11-21  Tomas Cerha  <cerha@brailcom.org>

	* sql/init.sql: Operator fixed.

	* sql/wiking.sql: Typo fixed.

2006-11-13  Tomas Cerha  <cerha@brailcom.org>

	* defs/application.py: Fixed copyright and author information.

	* lib/wiking/*.py: Fixed copyright and author information.

	* COPYING: New file.

	* translations/wiking.*.po: Updated.

	* lib/wiking/export.py (Exporter._menu): Don't hardcode the label
	to be hidden.  Just mark it as a label.
	(Module): Added basic accesskey support.

	* resources/css/default.css: Minor cleaning.

2006-11-11  Tomas Cerha  <cerha@brailcom.org>

	* translations/wiking.pl.po: Updated.

	* translations/wiking.es.po: New file.

	* lib/wiking/util.py (DocModule): Class removed.

	* lib/wiking/modules.py (Config.theme): Don't cache themes.

	* lib/wiking/handler.py (SiteHandler._doc): New method.
	(SiteHandler._resolve): Don't handle doc here.
	(SiteHandler.handle): Handle documentation requests differently.

	* lib/wiking/export.py (Exporter._node_uri): New method.
	(Exporter._is_current): Respect just the top level id.
	(Exporter._top): Add three divs to support several layers of
	backgrounf images.

ì006-11-08  Tomas Cerha  <cerha@brailcom.org>

	* translations/wiking.pl.po: Updated.

	* translations/wiking.cs.po: Updated.

	* translations/wiking-help.cs.po: Updated.
	
	* lib/wiking/util.py (DocModule.view): Search all the available
	language variants of the document and perform language selection
	according to the request.

	* lib/wiking/handler.py (Handler.__call__): Pass just an error
	message to `Request.error()'.

	* lib/wiking/request.py (Request.error): Accept just one argument
	- the error message.  Escape it befor printing.

2006-11-06  Tomas Cerha  <cerha@brailcom.org>

	* lib/wiking/module.py (WikingModule._document)
	(WikingModule._list): Use the new method
	`Request.prefered_language()'.

	* lib/wiking/modules.py (Modules.ModNameType): New type which only
	allows valid Module names.
	(Modules._FIELDS): Use it for `name'.

	* lib/wiking/handler.py (Handler.__call__): Some more information
	about the request added into the e-mail message.

	* lib/wiking/request.py (Request.error): Don't print the
	traceback, just a short error message.
	(WikingRequest.prefered_languages): New method.

2006-11-04  Tomas Cerha  <cerha@brailcom.org>

	* resources/css/default.css: Syntax fixed.

	* translations/wiking.pl.po: New file

	* translations/wiking.cs.po: Updated.
